# Random User Database Console App

Консольное приложение для загрузки случайных пользователей из сервиса https://api.randomuser.me в БД через Hibernate и выгрузки данных в CSV, Excel.

Требования:
- Использование Java, Spring, Hibernate

- Консольное приложение. При старте у пользователя запрашивается команда - _загрузить в БД_, _выгрузить из БД в CSV файл_.
- Наличие параметров. Пользователь может вводить количество пользователей для загрузки и для выгрузки.
- Предусмотреть в архитектуре возможность в перспективе выгрузки пользователей в другом формате.


## Используемые технологии

Java 17, Maven, Spring Boot, Spring Data JPA (Hibernate), H2 in-memory


## Инструкция по запуску

```bash
  git clone git@github.com:NikitaBuffy/random-user.git
```

```bash
  java -jar randomuser-0.0.1-SNAPSHOT.jar
```

Либо запуск класса `RandomuserApplication` из IDEA.

## Настройки

Настройки приложения осуществляются в `application.properties`.

Для смены БД замените значения в `spring.datasource.driverClassName`, `spring.datasource.url`, `spring.datasource.username` и `spring.datasource.password`

## Комментарий к реализации

Комментарии к классам и методам можно посмотреть в коде.

Основной принцип работы приложения: 
- консольное взаимодействие с пользователем - класс `ApplicationRunner`
- отправка запроса на `https://api.randomuser.me` и получение ответа с телом JSON - класс `RandomUserMeClient`
- десериализация JSON в объект - класс `JsonDeserializer`
- сохранение объекта в базу данных - класс `UserServiceImpl`
- получение объекта/объектов из базы данных - класс `UserServiceImpl`
- выгрузка в CSV, Excel - реализация интерфейса `ExportStrategy`

Помимо экспорта в CSV дополнительно реализовал выгрузку и в Excel файл. Архитектура предусматривает реализацию выгрузки пользователей в любом другом формате. Для этого необходимо создать класс, имплементирующий интерфейс `ExportStrategy`, реализовать логику, добавить в фабрику `ExportStrategyFactory` и добавить опцию в консоль.

Архитектура построена с учетом ООП и принципов SOLID, в том числе используя паттерны проектирования, такие как 'Стратегия' и 'Фабрика'.

В качестве базы данных использовал H2 in memory для быстрой демонстрации, но ее можно заменить на любую другую (см. предыдущий пункт).

Из-за объемного JSON с разной информацией о пользователе было принято решение разделить сущность на `User`, `UserLocation` и `UserLogin` и создать 3 соответствующие таблицы.

Изучив API сервиса RandomUserMe, добавил в приложение возможность в консоли выстраивать запрос с параметрами. Например, чтобы получить и загрузить сразу 100 пользователей, необходимо написать `results=100` (см. пункт Спецификация API RandomUserMe)

## Нуждается в доработке

Потенциально узкие места по производительности:

- Нет пакетной вставки (BATCH) при загрузке нескольких пользователей в БД _(вероятно, из-за вложенных объектов - дополнительных таблиц)_.
- Использование многопоточной среды, вероятно, улучшило бы производительность в некоторых частях кода. Например, в десериализаторе.

Недоработки:
- Обрабатываются только ответы 4xx и 5xx при запросе к API RandomUserMe. Если вернется, например, код 301, программа упадет. _Не успел доделать._
- При выборе определенного количества пользователей N для выгрузки из БД, она осуществляется с 1 до N при любых вариантах. _Стоит доделать динамическую выборку по запросу, по определенным параметрам пользователя и т.д._
- Каждая новая выгрузка в CSV или Excel перезаписывает предыдущий файл. Файлы недоступны для многократной записи. _Не успел доделать._
- Не обозначены CONSTRAINTS у таблиц в БД. _Не стал этого делать, так как API позволяет произвольно выгружать._
- Код не покрыт тестами. _Не успел._

## Спецификация API RandomUserMe
Для получения пользователей приложение отправляет запрос на:
```http
GET https://api.randomuser.me
```

| Параметр  | Значения                                                                              | Описание                                        |
|:----------|:--------------------------------------------------------------------------------------|:------------------------------------------------|
| `results` | `2 - 5000`                                                                            | Количество пользователей в ответе               |
| `gender`  | `male, female`                                                                        | Выбор пола                                      |
| `nat`     | `AU, BR, CA, CH, DE, DK, ES, FI, FR, GB, IE, IN, IR, MX, NL, NO, NZ, RS, TR, UA, US`  | Выбор национальности (нужные через запятую)     |
| `inc`     | `gender, name, location, email, login, registered, dob, phone, cell, id, picture, nat`| Выбор необходимых данных (нужные через запятую) |
| `exc`     | `gender, name, location, email, login, registered, dob, phone, cell, id, picture, nat`| Исключение данных (нужные через запятую)        |

Вы можете получить справку по доступным параметрам прямо из консоли перед загрузкой, написав `help`

Пример тела ответа:
```json
{
  "results": [
    {
      "gender": "male",
      "name": {
        "title": "Mr",
        "first": "Levi",
        "last": "Clarke"
      },
      "location": {
        "street": {
          "number": 8650,
          "name": "Wilson Road"
        },
        "city": "Tauranga",
        "state": "Hawke'S Bay",
        "country": "New Zealand",
        "postcode": 26223,
        "coordinates": {
          "latitude": "49.1404",
          "longitude": "-138.3091"
        },
        "timezone": {
          "offset": "+5:30",
          "description": "Bombay, Calcutta, Madras, New Delhi"
        }
      },
      "email": "levi.clarke@example.com",
      "login": {
        "uuid": "a1bdfc42-2a9a-4725-bab0-402d6a19e103",
        "username": "redbear379",
        "password": "nicola",
        "salt": "hOMNChwm",
        "md5": "ed0cbac451056d25f58c07a93944a29a",
        "sha1": "868e5bba03db02fa64a775a1bc116a3b40472491",
        "sha256": "69410b8da31d0728ea0487adb17134bfa5b8baf0dbc865d45b2a041520bd7a9f"
      },
      "dob": {
        "date": "1944-12-02T01:08:13.859Z",
        "age": 79
      },
      "registered": {
        "date": "2004-11-26T14:49:39.215Z",
        "age": 19
      },
      "phone": "(461)-680-0108",
      "cell": "(616)-427-1784",
      "id": {
        "name": "",
        "value": null
      },
      "picture": {
        "large": "https://randomuser.me/api/portraits/men/86.jpg",
        "medium": "https://randomuser.me/api/portraits/med/men/86.jpg",
        "thumbnail": "https://randomuser.me/api/portraits/thumb/men/86.jpg"
      },
      "nat": "NZ"
    }
  ],
  "info": {
    "seed": "f256ec1f619754a4",
    "results": 1,
    "page": 1,
    "version": "1.4"
  }
}
```